# Nexus Balances App - Complete Beginner's Guide

## üìã Table of Contents
1. [What is This App?](#what-is-this-app)
2. [Technologies Used](#technologies-used)
3. [Project Structure](#project-structure)
4. [Understanding the Code](#understanding-the-code)
5. [How It Works](#how-it-works)
6. [Setup Instructions](#setup-instructions)
7. [Advanced Concepts](#advanced-concepts)
8. [Troubleshooting](#troubleshooting)

---

## üéØ What is This App?

**Nexus Balances** is a Web3 application that allows users to:
- Connect their cryptocurrency wallet (like MetaMask)
- View their token balances across **5 different blockchain networks** in one place
- See all balances unified in a single, easy-to-read interface

Think of it like a banking app that shows all your accounts from different banks in one place, but for cryptocurrency!

### Key Features:
- üîê Wallet connection via MetaMask or other Web3 wallets
- üåê Multi-chain support (Ethereum, Base, Polygon, Arbitrum, Optimism)
- üí∞ Unified balance display
- üîÑ Real-time balance updates
- üé® Modern, beautiful UI

---

## üõ† Technologies Used

### Core Framework
- **Next.js 16** - React framework for building web applications
- **TypeScript** - Type-safe JavaScript
- **React 18** - UI library

### Web3 Technologies
- **Wagmi** - React hooks for Ethereum
- **Viem** - Ethereum libraries
- **ConnectKit** - Pre-built wallet connection UI
- **Nexus SDK** - Multi-chain balance aggregation (by Avail Project)

### Styling
- **Tailwind CSS** - Utility-first CSS framework
- **Lucide React** - Icon library

### State Management
- **React Query** - Data fetching and caching
- **React Context** - State sharing between components

---

## üìÅ Project Structure

```
my-nexus-app/
‚îú‚îÄ‚îÄ app/                          # Next.js App Router directory
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                  # Main page (what users see)
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Root layout (fonts, metadata)
‚îÇ   ‚îî‚îÄ‚îÄ globals.css               # Global styles
‚îú‚îÄ‚îÄ components/                   # React components
‚îÇ   ‚îú‚îÄ‚îÄ Web3Provider.tsx          # Web3 connection setup
‚îÇ   ‚îú‚îÄ‚îÄ NexusProvider.tsx         # Nexus SDK integration
‚îÇ   ‚îú‚îÄ‚îÄ WalletConnection.tsx      # Connect wallet button
‚îÇ   ‚îî‚îÄ‚îÄ UnifiedBalances.tsx       # Display balances
‚îú‚îÄ‚îÄ public/                       # Static assets
‚îú‚îÄ‚îÄ package.json                  # Dependencies
‚îú‚îÄ‚îÄ tsconfig.json                 # TypeScript config
‚îî‚îÄ‚îÄ next.config.ts                # Next.js config
```

---

## üí° Understanding the Code

### 1. **Root Layout** (`app/layout.tsx`)

```typescript
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
        {children}
      </body>
    </html>
  );
}
```

**What's happening here?**
- This is the root HTML structure for your entire app
- Loads custom fonts (Geist Sans and Geist Mono)
- Wraps all pages in a consistent layout
- `children` represents whatever page is currently being shown

**Think of it as:** The frame around a painting - it stays the same, but the picture inside changes.

---

### 2. **Global Styles** (`app/globals.css`)

```css
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}
```

**What's happening here?**
- Imports Tailwind CSS
- Sets up CSS variables for colors
- Automatically switches to dark mode if user's OS prefers it
- Applies basic body styles

**Think of it as:** The color palette and basic styling rules for your app.

---

### 3. **Main Page** (`app/page.tsx`)

```typescript
'use client';
import { Web3Provider } from '@/components/Web3Provider';
import { NexusProvider } from '@/components/NexusProvider';
import { WalletConnection } from '@/components/WalletConnection';
import { UnifiedBalances } from '@/components/UnifiedBalances';

export default function Home() {
    return (
        <Web3Provider>
            <NexusProvider>
                <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white p-8">
                    <header className="max-w-4xl mx-auto flex justify-between mb-8">
                        <h1 className="text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                            üåê Nexus Balances
                        </h1>
                        <WalletConnection />
                    </header>
                    <main className="max-w-4xl mx-auto">
                        <UnifiedBalances />
                    </main>
                </div>
            </NexusProvider>
        </Web3Provider>
    );
}
```

**What's happening here?**
- `'use client'` tells Next.js this runs in the browser (needed for Web3 interactions)
- Creates a page layout with:
  - Gradient background
  - Header with title and connect button
  - Main area showing balances
- Uses **provider components** to wrap the app with Web3 and Nexus functionality

**The Provider Pattern:**
```
Web3Provider (outermost)
  ‚îî‚îÄ NexusProvider
      ‚îî‚îÄ Page Content (WalletConnection + UnifiedBalances)
```

Each provider "pours" its functionality down to all children components.

**Think of it as:** Russian nesting dolls - each layer adds capabilities to the inner layers.

---

### 4. **Web3 Provider** (`components/Web3Provider.tsx`)

```typescript
'use client';

import { WagmiProvider, createConfig, http } from 'wagmi';
import {
    sepolia, baseSepolia, polygonAmoy, arbitrumSepolia, optimismSepolia
} from 'wagmi/chains';
import { ConnectKitProvider, getDefaultConfig } from 'connectkit';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactNode, useState } from 'react';

const config = createConfig(
    getDefaultConfig({
        appName: 'My Nexus App',
        walletConnectProjectId: process.env.NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID!,
        chains: [sepolia, baseSepolia, polygonAmoy, arbitrumSepolia, optimismSepolia],
    })
);

export function Web3Provider({ children }: { children: ReactNode }) {
    const [queryClient] = useState(() => new QueryClient());
    return (
        <QueryClientProvider client={queryClient}>
            <WagmiProvider config={config}>
                <ConnectKitProvider>{children}</ConnectKitProvider>
            </WagmiProvider>
        </QueryClientProvider>
    );
}
```

**What's happening here?**
- **Wagmi** - Creates configuration to connect to blockchain networks
- **5 Test Networks**:
  - `sepolia` - Ethereum testnet
  - `baseSepolia` - Base (Coinbase's L2) testnet
  - `polygonAmoy` - Polygon testnet
  - `arbitrumSepolia` - Arbitrum testnet
  - `optimismSepolia` - Optimism testnet

- **ConnectKit** - Provides the wallet connection UI
- **React Query** - Manages data fetching and caching
- Wraps children with all three providers

**Why three layers?**
- QueryClientProvider ‚Üí Handles data caching
- WagmiProvider ‚Üí Handles blockchain connections
- ConnectKitProvider ‚Üí Handles wallet UI

**Think of it as:** Setting up plumbing, electricity, and internet before you can use them throughout the house.

---

### 5. **Nexus Provider** (`components/NexusProvider.tsx`)

```typescript
'use client';

import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
import { useAccount } from 'wagmi';

const NexusContext = createContext<any>(undefined);

export function NexusProvider({ children }: { children: ReactNode }) {
    const { isConnected } = useAccount();
    const [sdk, setSdk] = useState<any>(null);
    const [balances, setBalances] = useState<any[]>([]);
    const [isLoading, setIsLoading] = useState(false);

    useEffect(() => {
        if (isConnected && !sdk) initNexus();
    }, [isConnected]);

    const initNexus = async () => {
        setIsLoading(true);
        const { NexusSDK } = await import('@avail-project/nexus');
        const nexus = new NexusSDK({ network: 'testnet' });
        await nexus.initialize(window.ethereum);

        // Auto-approve for demo (real app: ask user)
        nexus.setOnAllowanceHook(({ allow }) => allow(['min']));
        nexus.setOnIntentHook(({ allow }) => allow());

        setSdk(nexus);
        getBalances(nexus);
        setIsLoading(false);
    };

    const getBalances = async (nexus: any) => {
        const unified = await nexus.getUnifiedBalances();
        setBalances(unified);
    };

    return (
        <NexusContext.Provider value={{ balances, isLoading, sdk, refresh: () => getBalances(sdk) }}>
            {children}
        </NexusContext.Provider>
    );
}

export const useNexus = () => useContext(NexusContext)!;
```

**What's happening here?**

**State Management:**
- `isConnected` - Checks if wallet is connected (from Wagmi)
- `sdk` - Stores the Nexus SDK instance
- `balances` - Stores all balances from all chains
- `isLoading` - Shows loading state

**useEffect Hook:**
```typescript
useEffect(() => {
    if (isConnected && !sdk) initNexus();
}, [isConnected]);
```
This runs automatically when `isConnected` changes. It says: "If wallet is connected but SDK isn't initialized, initialize it."

**initNexus Function:**
1. Loads the Nexus SDK library
2. Creates SDK instance in testnet mode
3. Connects it to MetaMask (`window.ethereum`)
4. Sets up auto-approval hooks (for demo purposes)
5. Fetches balances

**getBalances Function:**
- Calls the magic method: `nexus.getUnifiedBalances()`
- This single call fetches balances from ALL 5 chains
- Updates the balances state

**Context Provider:**
Makes `balances`, `isLoading`, `sdk`, and `refresh` available to all child components.

**Think of it as:** A smart assistant that:
- Waits for wallet connection
- Talks to all blockchains simultaneously
- Gathers all your balances
- Makes them available to the rest of the app

---

### 6. **Wallet Connection Component** (`components/WalletConnection.tsx`)

```typescript
'use client';
import { ConnectKitButton } from 'connectkit';
import { Wallet } from 'lucide-react';

export function WalletConnection() {
    return (
        <ConnectKitButton.Custom>
            {({ show }) => (
                <button onClick={show} className="bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                    <Wallet size={20} /> Connect Wallet
                </button>
            )}
        </ConnectKitButton.Custom>
    );
}
```

**What's happening here?**
- Uses ConnectKit's custom button component
- Shows a styled "Connect Wallet" button
- When clicked, opens ConnectKit's wallet selection modal
- User can choose MetaMask, WalletConnect, Coinbase Wallet, etc.

**Think of it as:** The front door to your house - click to enter!

---

### 7. **Unified Balances Component** (`components/UnifiedBalances.tsx`)

```typescript
'use client';
import { useNexus } from './NexusProvider';
import { RefreshCw, Coins } from 'lucide-react';

export function UnifiedBalances() {
    const { balances, isLoading, refresh } = useNexus();

    if (isLoading) return <div>Loading balances... üîÑ</div>;

    return (
        <div className="p-8 bg-white rounded-2xl shadow-lg">
            <div className="flex justify-between mb-6">
                <h2 className="text-2xl font-bold">Your Balances</h2>
                <button onClick={refresh} className="flex gap-2 px-4 py-2 bg-gray-100 rounded-lg">
                    <RefreshCw className="w-4 h-4" /> Refresh
                </button>
            </div>
            <div className="grid gap-4">
                {balances.map((b: any, i: number) => (
                    <div key={i} className="p-4 border rounded-lg">
                        <strong>{b.chainName}</strong> - {b.tokenSymbol}: **{b.formattedAmount}**
                    </div>
                ))}
                {balances.length === 0 && <p>Add test tokens! üí∞</p>}
            </div>
        </div>
    );
}
```

**What's happening here?**

**Data Access:**
- Uses `useNexus()` hook to get data from NexusProvider context
- Gets `balances`, `isLoading`, and `refresh` function

**Loading State:**
- If loading, shows "Loading balances... üîÑ"

**Display:**
- Shows a card with title and refresh button
- Maps through each balance and displays:
  - Chain name (e.g., "Ethereum Sepolia")
  - Token symbol (e.g., "ETH")
  - Formatted amount (e.g., "1.5")

**Empty State:**
- If no balances, shows "Add test tokens! üí∞"

**Think of it as:** A dashboard that displays your cryptocurrency portfolio!

---

## üîÑ How It Works (Flow Diagram)

```
User Opens App
      ‚Üì
app/page.tsx loads
      ‚Üì
Web3Provider initializes (sets up blockchain connections)
      ‚Üì
NexusProvider initializes (waits for wallet)
      ‚Üì
User sees "Connect Wallet" button
      ‚Üì
User clicks ‚Üí ConnectKit modal opens
      ‚Üì
User selects MetaMask (or other wallet)
      ‚Üì
Wallet connects ‚Üí isConnected becomes true
      ‚Üì
useEffect in NexusProvider triggers
      ‚Üì
initNexus() runs:
  - Loads Nexus SDK
  - Connects to window.ethereum
  - Sets up auto-approval hooks
      ‚Üì
getBalances() called
      ‚Üì
nexus.getUnifiedBalances() fetches from ALL 5 chains in parallel
      ‚Üì
Balances displayed in UnifiedBalances component
      ‚Üì
User can click Refresh to update balances
```

---

## üöÄ Setup Instructions

### Prerequisites

1. **Node.js** installed (v18 or higher)
   ```bash
   node --version  # Check your version
   ```

2. **A code editor** (VS Code recommended)

3. **MetaMask browser extension** installed
   - Download from: https://metamask.io

4. **WalletConnect Project ID** (free)
   - Go to: https://cloud.walletconnect.com
   - Create account
   - Create project
   - Copy Project ID

### Installation Steps

1. **Clone or download the project**
   ```bash
   cd my-nexus-app
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Set up environment variables**
   
   Create a `.env.local` file in the root directory:
   ```bash
   touch .env.local
   ```
   
   Add your WalletConnect Project ID:
   ```
   NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=your_project_id_here
   ```

4. **Run the development server**
   ```bash
   npm run dev
   ```

5. **Open in browser**
   - Navigate to: http://localhost:3000

6. **Connect your wallet**
   - Click "Connect Wallet"
   - Select MetaMask
   - Approve connection

7. **Get test tokens**
   - Visit testnet faucets to get free test tokens
   - Search for "[chain name] testnet faucet" in your browser

---

## üéì Advanced Concepts

### Client vs Server Components

**Server Components** (default in Next.js 13+):
- Render on the server
- Faster initial load
- Can access databases, APIs
- Cannot use browser APIs
- Cannot use hooks or event handlers

**Client Components** (`'use client'`):
- Render in the browser
- Can use browser APIs (`window.ethereum`)
- Can use hooks and event handlers
- Can respond to user interactions

**In this app:**
- `layout.tsx` - Server component (fonts, metadata)
- `page.tsx` - Client component (interactive UI)
- All components in `/components` - Client components (Web3 features)

---

### Context API Pattern

```typescript
// 1. Create context
const MyContext = createContext(undefined);

// 2. Create provider component
function MyProvider({ children }) {
    const [data, setData] = useState(initialValue);
    
    return (
        <MyContext.Provider value={{ data, setData }}>
            {children}
        </MyContext.Provider>
    );
}

// 3. Create custom hook
function useMyData() {
    return useContext(MyContext);
}

// 4. Use in components
function MyComponent() {
    const { data } = useMyData();
    return <div>{data}</div>;
}
```

**Benefits:**
- Avoid "prop drilling" (passing props through many components)
- Centralized state management
- Cleaner code

---

### React Hooks Explained

**useState:**
```typescript
const [count, setCount] = useState(0);
// count is the value
// setCount is the function to update it
```

**useEffect:**
```typescript
useEffect(() => {
    // Runs after render
    // Good for: API calls, subscriptions, DOM manipulation
}, [dependencies]);
// Empty [] = runs once on mount
// [value] = runs when value changes
```

**useContext:**
```typescript
const contextValue = useContext(MyContext);
// Gets value from nearest provider
```

---

### Environment Variables

**In Next.js:**
- `.env.local` - Local development (gitignored)
- `.env.production` - Production
- `NEXT_PUBLIC_*` prefix - Exposed to browser
- No prefix - Server-only

**Example:**
```bash
# .env.local
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=abc123  # Available in browser
DATABASE_SECRET=xyz789  # Server-only, never sent to browser
```

---

### Wagmi and Chains

**Wagmi** is a React library for Ethereum:
- Provides hooks for blockchain interactions
- Handles wallet connections
- Manages chain switching
- Abstracts away complex Web3 code

**Chains** are blockchain networks:
- Mainnet = real money
- Testnet = fake money for testing
- This app uses 5 different testnets

---

### Nexus SDK

**What it does:**
- Aggregates balances from multiple chains
- Handles cross-chain operations
- Simplifies multi-chain development

**Key methods:**
- `initialize(provider)` - Connect to wallet
- `getUnifiedBalances()` - Get all balances
- `setOnAllowanceHook()` - Handle permissions
- `setOnIntentHook()` - Handle transactions

---

## üêõ Troubleshooting

### "Cannot read property 'ethereum' of undefined"

**Problem:** Browser doesn't have MetaMask installed.

**Solution:** Install MetaMask or use another Web3 wallet.

---

### "Invalid WalletConnect Project ID"

**Problem:** Environment variable not set correctly.

**Solution:** 
1. Check `.env.local` exists
2. Verify `NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID` is set
3. Restart dev server

---

### "No balances showing"

**Problem:** Wallet not connected or no tokens on testnet.

**Solution:**
1. Click "Connect Wallet"
2. Get test tokens from faucets
3. Click "Refresh" button

---

### "buf.writeUint32BE is not a function"

**Problem:** Nexus SDK needs Buffer polyfill in the browser.

**Solution:**
1. Make sure `next.config.ts` has webpack polyfill configuration
2. Verify `buffer` package is installed: `npm list buffer`
3. Clean build cache and restart:
```bash
rm -rf .next
npm run dev
```
4. Clear browser cache and reload

This is already configured in your project!

---

### "Build errors"

**Problem:** TypeScript or dependency issues.

**Solution:**
```bash
# Clean install
rm -rf node_modules package-lock.json
npm install

# Type checking
npm run lint
```

---

### Port 3000 already in use

**Problem:** Another app is using port 3000.

**Solution:**
```bash
# Use a different port
PORT=3001 npm run dev
```

---

## üìö Key Resources

### Documentation Links

- **Next.js**: https://nextjs.org/docs
- **Wagmi**: https://wagmi.sh
- **ConnectKit**: https://docs.family.co/connectkit
- **Nexus SDK**: Check Avail Project docs
- **Tailwind CSS**: https://tailwindcss.com/docs
- **React**: https://react.dev
- **TypeScript**: https://www.typescriptlang.org/docs

### Learning Path

1. **Learn React basics** (components, props, state, hooks)
2. **Learn Next.js** (App Router, pages, routing)
3. **Learn TypeScript** (types, interfaces, generics)
4. **Learn Tailwind CSS** (utility classes)
5. **Learn Web3 basics** (blockchain, wallets, transactions)
6. **Learn Wagmi** (React hooks for Web3)

---

## üéØ Next Steps

### Ideas for Enhancement

1. **Add transaction history**
   - Show recent transactions
   - Cross-chain transfer history

2. **Add token search/filter**
   - Search by token name
   - Filter by chain

3. **Add portfolio summary**
   - Total value across all chains
   - Asset allocation chart

4. **Add dark mode toggle**
   - Manual dark/light mode switch
   - Persist preference

5. **Add error handling**
   - Better error messages
   - Retry mechanisms

6. **Add mainnet support**
   - Switch between testnet and mainnet
   - Real money transactions

---

## ‚úÖ Summary

**You've learned:**
- ‚úÖ What the app does (multi-chain balance viewer)
- ‚úÖ Technologies used (Next.js, Wagmi, Nexus SDK, Tailwind)
- ‚úÖ Project structure and file organization
- ‚úÖ How each component works
- ‚úÖ The data flow from wallet to UI
- ‚úÖ How to set up and run the project
- ‚úÖ Advanced concepts (Context, Hooks, etc.)
- ‚úÖ How to troubleshoot issues

**The app is:**
- A Next.js React application
- Using TypeScript for type safety
- Styled with Tailwind CSS
- Connected to 5 blockchain networks
- Using Nexus SDK for unified balances
- Fully client-side interactive

**You're now ready to:**
- Modify and customize the app
- Add new features
- Understand the codebase
- Deploy to production

---

## üôè Final Notes

This app demonstrates modern Web3 development patterns:
- **Provider pattern** for state management
- **Custom hooks** for reusable logic
- **Context API** for data sharing
- **Client-side rendering** for interactivity
- **Component composition** for structure

Take your time understanding each piece. Experiment with the code. Read the documentation. Build something cool!

**Happy coding! üöÄ**

